From fca6f68d799ab40f690508e253cc5981567e116c Mon Sep 17 00:00:00 2001
From: Terigele <terigele@huawei.com>
Date: Wed, 26 Dec 2018 16:34:26 +0800
Subject: [PATCH 19/25] AMS: Fix the null pointer exception in
 MainHandler:handleMessage

Test: NA.
Change-Id: Icea63c103c8b652a7d6be12bad076be049bc296d
Signed-off-by: mydongistiny <jaysonedson@gmail.com>
Signed-off-by: DennySPB <dennyspb@gmail.com>
---
 .../core/java/com/android/server/am/ActivityManagerService.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/services/core/java/com/android/server/am/ActivityManagerService.java b/services/core/java/com/android/server/am/ActivityManagerService.java
index 917131736561..55def1a380cc 100644
--- a/services/core/java/com/android/server/am/ActivityManagerService.java
+++ b/services/core/java/com/android/server/am/ActivityManagerService.java
@@ -2481,7 +2481,7 @@ public class ActivityManagerService extends IActivityManager.Stub
                 synchronized (mPidsSelfLocked) {
                     for (int i = 0; i < mPidsSelfLocked.size(); i++) {
                         final ProcessRecord p = mPidsSelfLocked.valueAt(i);
-                        if (p.uid == uid) {
+                        if (p.uid == uid && p.thread != null) {
                             try {
                                 p.thread.notifyCleartextNetwork(firstPacket);
                             } catch (RemoteException ignored) {
-- 
2.17.1

