From 886b5da4f44296ef688bab49b5f4a1ffe75d8f0b Mon Sep 17 00:00:00 2001
From: Chih-Wei Huang <cwhuang@linux.org.tw>
Date: Fri, 23 Sep 2016 17:59:47 +0800
Subject: [PATCH 11/23] init: set default value of ro.hardware to the target
 name

People usually forget to set the value of androidboot.hardware to
the target name in kernel cmdline which results in boot failure.

The change tries to reduce such an error in the future. The target
name is hardcoded to the image. This eliminates the necessity of
androidboot.hardware.

Conflicts:
	init/Android.mk

Change-Id: I253413ae7fb9790b991dd2d727528c6083baa019
---
 init/Android.mk | 13 ++++++++++++-
 init/init.cpp   |  2 +-
 2 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/init/Android.mk b/init/Android.mk
index c89bacc99e..5fbbd386cb 100644
--- a/init/Android.mk
+++ b/init/Android.mk
@@ -41,7 +41,18 @@ init_cflags += \
 
 include $(CLEAR_VARS)
 LOCAL_CPPFLAGS := $(init_cflags)
-LOCAL_SRC_FILES := main.cpp
+LOCAL_CPPFLAGS += -DTARGET_PRODUCT=\"$(TARGET_PRODUCT)\"
+LOCAL_SRC_FILES := main.cpp \
+    bootchart.cpp \
+    builtins.cpp \
+    init_first_stage.cpp \
+    init.cpp \
+    keychords.cpp \
+    property_service.cpp \
+    reboot.cpp \
+    signal_handler.cpp \
+    ueventd.cpp \
+    watchdogd.cpp \
 
 LOCAL_MODULE:= init
 
diff --git a/init/init.cpp b/init/init.cpp
index 4fe115e924..3c020366e7 100644
--- a/init/init.cpp
+++ b/init/init.cpp
@@ -381,7 +381,7 @@ static void export_kernel_boot_props() {
         { "ro.boot.mode",       "ro.bootmode",   "unknown", },
         { "ro.boot.baseband",   "ro.baseband",   "unknown", },
         { "ro.boot.bootloader", "ro.bootloader", "unknown", },
-        { "ro.boot.hardware",   "ro.hardware",   "unknown", },
+        { "ro.boot.hardware",   "ro.hardware",   TARGET_PRODUCT, },
         { "ro.boot.revision",   "ro.revision",   "0", },
     };
     for (size_t i = 0; i < arraysize(prop_map); i++) {
-- 
2.17.1

